---
title: "Midpoint Deliverable"
author: "Daniel Chen, Grace Teebken, Tanner Lauzon, Kellen Maier"
date: "05/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)

# import natural disaster and average temp by country cleaning functions
source("scripts/data_cleaning.R")
# import summary info calculation functions
source("scripts/summary_info.R")
# import plotting functions to test
source("test_natural_disasters.R")

# load libraries
library(dplyr)
library(ggplot2)
```

```{r include=FALSE, cache=TRUE}
clean_kaggle_nd_data <- function(nd_data, type) {
  # remove "Code" column
  nd_data <- select(nd_data, -"Code")
  # rename columns
  if (type == "econ") {
    colnames(nd_data) <- c("disaster", "year", "damage")
  } else {
    colnames(nd_data) <- c("disaster", "year", "count")
  }
  # remove any rows with NA
  nd_data <- nd_data[complete.cases(nd_data), ]

  return(nd_data)
}

# cleans kaggle specific global temperature data
# parameters:
#   - glo_temp_data = dataframe of kaggle's global temperature data
clean_kaggle_glo_temp_data <- function(glo_temp_data) {
  # select for relevant data
  glo_temp_data <-
    glo_temp_data %>%
    select(dt,
           LandAverageTemperature,
           LandAndOceanAverageTemperature)
  # remove any rows with NA
  glo_temp_data <- glo_temp_data[complete.cases(glo_temp_data), ]
  # get year column
  glo_temp_data <-
    glo_temp_data %>%
    mutate(year = as.integer(substring(dt, 1, 4)))
  # gather by year data (as original data is in weird time arrangement)
  glo_temp_data <-
    glo_temp_data %>%
    group_by(year) %>%
    summarize(mean_land_ocean_temp =
                mean(LandAndOceanAverageTemperature,
                     na.rm = TRUE),
              mean_land_temp =
                mean(LandAverageTemperature,
                     na.rm = TRUE))
  # remove any rows with NA, just to make sure
  glo_temp_data <- glo_temp_data[complete.cases(glo_temp_data), ]

  return(glo_temp_data)
}

# FINAL MERGING AND CLEANING FUNCTIONS
# combines and cleans global temperature data, count and damage of
#   natural disasters
# parameters:
#   - glo_temp = dataframe of global temperature data
#   - nd_count = dataframe of count of natural disaster eventsa
#   - nd_econ = dataframe of damage of natural disasters events in USD
get_clean_natural_disaster <- function(glo_temp, nd_count, nd_econ) {
  # clean up natural disaster count dataframe
  nd_count <- clean_kaggle_nd_data(nd_count, "count")
  # clean up natural disaster damage dataframe
  nd_econ <- clean_kaggle_nd_data(nd_econ, "econ")
  # clean up global temp data
  glo_temp <- clean_kaggle_glo_temp_data(glo_temp)
  # merge data
  # merge natural disaster data together
  result <- left_join(nd_econ,
                      nd_count,
                      by = c("year", "disaster"))
  # merge combined natural disaster with global temp data
  result <- left_join(result,
                      glo_temp,
                      by = c("year"))
  # clean up any new NA values
  result <- result[complete.cases(result), ]

  return(result)
}
```

## Introduction
This project will focus on global climate change impacts and consider temperature changes as well as natural disaster events. We aim to visualize trends in global disasters and temperature data. This will help illuminate areas that have been impacted by climate change the most. We hope that this project will lead to greater awareness of the extent of climate change impacts as well as an understanding of which areas need the most attention and resources for combating the effects of climate change.

## Data Cleaning
We will be examining **two datasets** for this deliverable. The first consists of *yearly average land temperatures per country*. The other consists of a combination of *yearly global average land temperatures* and *yearly count and total damages of natural disaster events*. We have already gathered the necessary data cleaning functions in `{r setup}` from `scripts/data_cleaning.R` and below we first gather all of the seperate csv files and load them in as dataframes.
```{r, cache=TRUE}
# DATASET 1
# gather average land temperature by country
avg_temp_by_country <-
  read.csv("data/kaggle_global_temp/GlobalLandTemperaturesByCountry.csv",
           stringsAsFactors = FALSE)

# DATASET 2
# gather global temperature averages
global_temp <-
  read.csv("data/kaggle_global_temp/GlobalTemperatures.csv",
           stringsAsFactors = FALSE)

# gather natural disaster counts
natural_disaster_count <-
  read.csv("data/kaggle_natural_disaster/number-of-natural-disaster-events.csv",
           stringsAsFactors = FALSE)

# gather natural disaster USD damages
natural_disaster_damage <-
  read.csv("data/kaggle_natural_disaster/economic-damage-from-natural-disasters.csv",
           stringsAsFactors = FALSE)
```


We then clean up and combine the individual dataframes to get our final datasets that we will be using in our further analyses.
```{r, cache=TRUE}
# DATASET 1
# get clean average temperature by country dataset
avg_country_temp_data <-
  get_clean_avg_country_temp(avg_temp_by_country)

# DATASET 2
# get clean combined natural disaster count, damage, and temp dataset
natural_disaster_data <-
  get_clean_natural_disaster(global_temp,
                             natural_disaster_count,
                             natural_disaster_damage)
```


## Summary Information

```{r}
# gather summary info for DATASET 1 - average country temperature
temp_summary_info <- get_summary_info_temp(avg_country_temp_data)

# gather summary info for DATASET 2 - natural disaster count, damage,
#   and associated global temperature
disaster_summary_info <- get_summary_info_disaster(natural_disaster_data)
```

Our first dataset, which has average temperatures by country, has **value here** entries. 

Our second dataset, which combines the natural disasters and temperatures by country, has **value here** entries.


## Aggregate Table
This table contains information about ___ and highlights ___.
**table here**

## Data Visualizations
This first chart shows the relationship between ___ and ___. 

```{r}
#plot_one
colnames(natural_disaster_data)
```


This chart shows the relationship between ___ and ___.

```{r, warning=FALSE, message=FALSE}
#plot_two
trendline_nd_count_by_year(natural_disaster_data)
```


This chart shows the relationship between ___ and ___.

```{r, warning=FALSE, message=FALSE}
#plot_three
scatter_nd_count_by_temp(natural_disaster_data)
```

